<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="icon.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&display=swap" rel="stylesheet">
    <title>Password Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-darker: #020617;
            --card-bg: #1e293b;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Work Sans', system-ui, -apple-system, sans-serif;
        }

        body {
            background: var(--bg-darker);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 2rem;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, var(--accent), #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            margin: 0;
            font-size: 0.9em;
            color: #94a3b8;
          }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 0.5rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-radius: 6px 6px 0 0;
            font-weight: 500;
            transition: all 0.2s;
            color: var(--text-secondary);
        }

        .tab.active {
            background: var(--card-bg);
            color: var(--text-primary);
            border-bottom: 3px solid var(--accent);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .control-group {
            margin-bottom: 1.25rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            background: var(--bg-dark);
            border-radius: 4px;
            -webkit-appearance: none;
            margin-bottom: 0.5rem;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 0.75rem;
            margin: 1rem 0;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkbox-item input {
            width: 16px;
            height: 16px;
        }

        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-block {
            display: block;
            width: 100%;
            text-align: center;
        }

        .btn-secondary {
            background: var(--card-bg);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-dark);
        }

        .safety-textarea {
          width: 100%;
          min-height: 150px;
          background: var(--bg-dark);
          color: var(--text-primary);
          border: 1px solid var(--border);
          border-radius: 8px;
          padding: 1rem;
          font-family: 'Manrope', monospace;
          font-size: 26px; /* Your requested size */
          resize: none;
          margin-bottom: 1rem;
          line-height: 1.6;
          box-sizing: border-box;
          word-wrap: break-word;
          white-space: pre-wrap;
        }
        
        textarea:not(.safety-textarea) {
          width: 100%;
          min-height: 150px;
          background: var(--bg-dark);
          color: var(--text-primary);
          border: 1px solid var(--border);
          border-radius: 8px;
          padding: 1rem;
          font-family: 'Manrope', monospace;
          font-size: 30px;
          resize: none;
          margin-bottom: 1rem;
          line-height: 1.6;
          box-sizing: border-box;
        }

        .password-strength {
            margin-top: 1rem;
        }

        .strength-meter {
            height: 8px;
            background: var(--bg-dark);
            border-radius: 4px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .strength-bar {
            height: 100%;
            width: 0%;
            transition: all 0.3s ease;
        }

        .analysis-results {
            margin-top: 1rem;
        }

        .analysis-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px dashed var(--border);
        }

        .analysis-item:last-child {
            border-bottom: none;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .title-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            text-align: left;
        }

        .password-history {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #ccc;
            flex-wrap: wrap;
        }
        
        .history-item .password {
            flex: 1;
            min-width: 0;
            margin-right: 10px;
            word-break: break-word;
            overflow-wrap: anywhere;
        }
        
        .site-logo {
          max-width: 72px;
          max-height: 72px;
          height: auto;
          width: auto;
        }

        .title-text h1 {
            margin: 0;
          }
        
        .history-item .actions {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background: var(--card-bg);
            color: var(--text-primary);
            text-align: center;
            border-radius: 6px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            border: 1px solid var(--border);
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        @media (max-width: 768px) {
            .safety-textarea {
                font-size: 18px !important;
                padding: 12px !important;
            }
              
            textarea:not(.safety-textarea) {
                font-size: 24px !important;
            }
            .grid {
                grid-template-columns: 1fr;
            }
    
            .tabs {
                overflow-x: auto;
                padding-bottom: 0;
            }
            .title-bar {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="site-header">
            <div class="title-bar">
              <img src="icon.png" alt="Site Logo" class="site-logo">
              <div class="title-text">
                <h1>ULTRA Password Generator</h1>
                <p class="subtitle">Generate, analyze, and manage secure passwords</p>
              </div>
            </div>
          </header>

        <div class="tabs">
            <div class="tab active" data-tab="generator">Generator</div>
            <div class="tab" data-tab="analyzer">Analyzer</div>
            <div class="tab" data-tab="history">History</div>
            <div class="tab" data-tab="settings">Settings</div>
            <div class="tab" data-tab="safety">Safety</div>
        </div>

        <div id="generator" class="tab-content active">
            <div class="grid">
                <div class="card">
                    <h2>Configuration</h2>
                    <div class="control-group">
                        <label for="length">Password Length: <span id="length-value">16</span></label>
                        <input type="range" id="length" min="8" max="64" value="16">
                        <div class="range-labels">
                            <span>8</span>
                            <span>64</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Character Sets</label>
                        <div class="checkbox-grid">
                            <div class="checkbox-item">
                                <input type="checkbox" id="lowercase" checked>
                                <label for="lowercase">Lowercase (a-z)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="uppercase" checked>
                                <label for="uppercase">Uppercase (A-Z)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="digits" checked>
                                <label for="digits">Digits (0-9)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="special" checked>
                                <label for="special">Special (!@#...)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="similar" checked>
                                <label for="similar">Allow similar (iIl1)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="ambiguous" checked>
                                <label for="ambiguous">Allow ambiguous ({ } [ ])</label>
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <label for="prefix">Prefix</label>
                        <input type="text" id="prefix" placeholder="Optional prefix">
                    </div>

                    <div class="control-group">
                        <label for="postfix">Postfix</label>
                        <input type="text" id="postfix" placeholder="Optional postfix">
                    </div>

                    <div class="control-group">
                        <label for="num-passwords">Number to generate</label>
                        <input type="number" id="num-passwords" min="1" max="10" value="1">
                    </div>

                    <button id="generate-btn" class="btn btn-block">
                        <i class="fas fa-bolt"></i> Generate Passwords
                    </button>
                </div>

                <div class="card">
                    <h2>Generated Passwords</h2>
                    <textarea id="output" readonly style="font-size: 20px;"></textarea>

                    <div class="password-strength">
                        <label>Password Strength</label>
                        <div class="strength-meter">
                            <div class="strength-bar" id="strength-bar"></div>
                        </div>
                        <div id="strength-text">Strength: Unknown</div>
                        <div id="entropy">Entropy: 0 bits</div>
                    </div>

                    <button id="copy-btn" class="btn btn-block btn-secondary">
                        <i class="far fa-copy"></i> Copy All
                    </button>
                    <button id="save-btn" class="btn btn-block">
                        <i class="far fa-save"></i> Save to History
                    </button>
                </div>
            </div>
            <div class="card" style="margin-top: 20px;">
              <h2>Passphrase Generator</h2>
              <div class="control-group">
                <label for="passphrase-length">Number of Words: <span id="passphrase-length-value">4</span></label>
                <input type="range" id="passphrase-length" min="3" max="12" value="4">
                <div class="range-labels">
                  <span>3</span>
                  <span>12</span>
                </div>
              </div>
            
              <div class="control-group">
                <label for="num-passphrases">Number to Generate</label>
                <input type="number" id="num-passphrases" min="1" max="10" value="1">
              </div>
            
              <div class="control-group">
                <label for="prefix-phrase">Prefix</label>
                <input type="text" id="prefix-phrase" placeholder="Optional prefix">
              </div>
            
              <div class="control-group">
                <label for="postfix-phrase">Postfix</label>
                <input type="text" id="postfix-phrase" placeholder="Optional postfix">
              </div>
                
              <div class="control-group">
                <label for="character-between-phrase">Character Between Words</label>
                <input type="text" id="character-between-phrase" placeholder="Default is '-'">
              </div>
            
              <button id="generate-passphrase-btn" class="btn btn-block">
                <i class="fas fa-bolt"></i> Generate Passphrases
              </button>
            
              <textarea id="output-passphrases" readonly style="font-size: 20px; margin-top: 10px; height: 150px;"></textarea>
            
              <div class="password-strength" style="margin-top: 10px;">
                <label>Passphrase Strength</label>
                <div class="strength-meter">
                  <div class="strength-bar" id="strength-bar-passphrase"></div>
                </div>
                <div id="strength-text-passphrase">Strength: Unknown</div>
                <div id="entropy-passphrase">Entropy: 0 bits</div>
              </div>
            
              <button id="copy-passphrase-btn" class="btn btn-block btn-secondary" style="margin-top: 10px;">
                <i class="far fa-copy"></i> Copy All
              </button>
            </div>
        </div>

        <div id="analyzer" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h2>Password Analysis</h2>
                    <textarea id="analyze-input" placeholder="Paste a password to analyze" style="font-size: 20px;"></textarea>
                    <button id="analyze-btn" class="btn btn-block">
                        <i class="fas fa-search"></i> Analyze Password
                    </button>
                </div>

                <div class="card">
                    <h2>Analysis Results</h2>
                    <div id="analysis-results" class="analysis-results">
                        <p>No password analyzed yet. Enter a password in the analyzer to see detailed information.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="history" class="tab-content">
            <div class="card">
                <h2>Password History</h2>
                <div class="password-history" id="password-history">
                    <p>No passwords saved yet. Generate and save passwords to view them here.</p>
                </div>
                <button id="clear-history" class="btn btn-block btn-secondary">
                    <i class="fas fa-trash"></i> Clear History
                </button>
                <button id="export-history" class="btn btn-block btn-primary">
                    <i class="fas fa-download"></i> Export History
                </button>
            </div>
        </div>

        <div id="settings" class="tab-content">
            <div class="card">
                <h2>Settings</h2>
                <div class="control-group">
                    <label for="theme">Theme</label>
                    <select id="theme" class="btn btn-block">
                        <option value="dark">Dark</option>
                        <option value="light">Light (WIP)</option>
                        <option value="oled">OLED Black (WIP)</option>
                    </select>
                    <small class="text-warning">Note: Light and OLED Black themes are currently a work in progress.</small>
                </div>

                <div class="control-group">
                    <label for="default-length">Default Password Length</label>
                    <input type="range" id="default-length" min="8" max="64" value="16">
                    <div class="range-labels">
                        <span>8</span>
                        <span>64</span>
                    </div>
                </div>

                <div class="control-group">
                    <label for="auto-copy">Auto-copy on generate</label>
                    <input type="checkbox" id="auto-copy">
                </div>

                <div class="control-group">
                    <label for="auto-save">Auto-save to history</label>
                    <input type="checkbox" id="auto-save">
                </div>

                <button id="export-settings" class="btn btn-block btn-secondary">
                    <i class="fas fa-file-export"></i> Export Settings
                </button>
                <button id="import-settings" class="btn btn-block">
                    <i class="fas fa-file-import"></i> Import Settings
                </button>
            </div>
        </div>
    </div>

    <div id="safety" class="tab-content">
        <div class="card">
            <h2>Safety</h2>

            <div class="control-group">
                <label for="tip1"><strong>Password Tip #1</strong></label>
                <textarea id="tip1" class="safety-textarea" rows="5" readonly>
Strong passwords mix uppercase, lowercase, numbers, and symbols. Avoid simple patterns like "12345" or "password". Aim for at least 12 characters in length. The more random your combination, the harder it is to crack. Special characters like @#$% can significantly increase security.
                </textarea>
            </div>

            <div class="control-group">
                <label for="tip2"><strong>Password Tip #2</strong></label>
                <textarea id="tip2" class="safety-textarea" rows="5" readonly>
Never use personal information like birthdays or pet names. Hackers can easily find these details online. Avoid dictionary words and common phrases. Instead, create random combinations unrelated to your life. Consider using the first letters of a memorable sentence.
                </textarea>
            </div>

            <div class="control-group">
                <label for="tip3"><strong>Password Tip #3</strong></label>
                <textarea id="tip3" class="safety-textarea" rows="5" readonly>
Reusing passwords puts all accounts at risk. Data breaches often expose passwords used on multiple sites. Password managers generate and store unique passwords securely. They encrypt your data and only require remembering one master password. Popular options include LastPass, Bitwarden, and 1Password.
                </textarea>
            </div>

            <div class="control-group">
                <label for="tip4"><strong>Password Tip #4</strong></label>
                <textarea id="tip4" class="safety-textarea" rows="5" readonly>
Two-factor authentication (2FA) adds crucial extra protection. Even with your password, hackers would need your phone or biometrics. Use authenticator apps instead of SMS when possible. Enable 2FA especially for email and financial accounts. Many services offer this in their security settings. Some recomendations for authenticator apps are: Google Authenticator, Microsoft Authenticator, Authy, Raivo OTP (iOS only), or Aegis Authenticator (Android only)
                </textarea>
            </div>

            <div class="control-group">
                <label for="tip5"><strong>Password Tip #5</strong></label>
                <textarea id="tip5" class="safety-textarea" rows="5" readonly>
Update important passwords every 3-6 months. Focus first on banking, email, and work accounts. Don't just increment numbers (Password1 to Password2). Create completely new passwords each time. Password managers can track when you last changed each password.
                </textarea>
            </div>

            <div class="control-group">
                <label for="tip6"><strong>Password Tip #6</strong></label>
                <textarea id="tip6" class="safety-textarea" rows="5" readonly>
Phishing scams try to trick you into revealing passwords. Check sender addresses carefully in suspicious emails. Never click "password reset" links you didn't request. Legitimate companies won't ask for passwords via email. When in doubt, visit websites directly instead of clicking links.
                </textarea>
            </div>

            <div class="control-group">
                <label for="tip7"><strong>Password Tip #7</strong></label>
                <textarea id="tip7" class="safety-textarea" rows="5" readonly>
Passphrases combine multiple random words for better security. They're longer but easier to remember than complex characters. Choose 4-6 unrelated words (correct-horse-battery-staple). Add numbers/symbols between words for extra strength. Ensure it's at least 15 characters total.
                </textarea>
            </div>
        </div>
    </div>

    <script>

        let wordsList = [];
        async function loadWords() {
          try {
            const response = await fetch('/words.json');
            if (!response.ok) throw new Error('Failed to load words.json');
            const data = await response.json();
            wordsList = data.words;
            console.log(`Loaded ${wordsList.length} words.`);
          } catch (error) {
            console.error('Error loading words:', error);
          }
        }
        
        const tabElements = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const lengthSlider = document.getElementById('length');
        const lengthValue = document.getElementById('length-value');
        const lowercaseCheck = document.getElementById('lowercase');
        const uppercaseCheck = document.getElementById('uppercase');
        const digitsCheck = document.getElementById('digits');
        const specialCheck = document.getElementById('special');
        const similarCheck = document.getElementById('similar');
        const ambiguousCheck = document.getElementById('ambiguous');
        const prefixInput = document.getElementById('prefix');
        const postfixInput = document.getElementById('postfix');
        const numPasswordsInput = document.getElementById('num-passwords');
        const generateBtn = document.getElementById('generate-btn');
        const copyBtn = document.getElementById('copy-btn');
        const saveBtn = document.getElementById('save-btn');
        const outputArea = document.getElementById('output');
        const strengthBar = document.getElementById('strength-bar');
        const strengthText = document.getElementById('strength-text');
        const entropyText = document.getElementById('entropy');
        const analyzeInput = document.getElementById('analyze-input');
        const analyzeBtn = document.getElementById('analyze-btn');
        const analysisResults = document.getElementById('analysis-results');
        const passwordHistory = document.getElementById('password-history');
        const clearHistoryBtn = document.getElementById('clear-history');
        const themeSelect = document.getElementById('theme');
        const defaultLength = document.getElementById('default-length');
        const autoCopyCheck = document.getElementById('auto-copy');
        const autoSaveCheck = document.getElementById('auto-save');
        const exportSettingsBtn = document.getElementById('export-settings');
        const importSettingsBtn = document.getElementById('import-settings');
        const passphraseLengthInput = document.getElementById('passphrase-length');
        const passphraseLengthDisplay = document.getElementById('passphrase-length-value');
        const passphraseCountInput = document.getElementById('num-passphrases');
        const passphrasePrefixInput = document.getElementById('prefix-phrase');
        const passphrasePostfixInput = document.getElementById('postfix-phrase');
        const generatePassphraseButton = document.getElementById('generate-passphrase-btn');
        const passphraseOutputBox = document.getElementById('output-passphrases');
        const passphraseStrengthBar = document.getElementById('strength-bar-passphrase');
        const passphraseStrengthText = document.getElementById('strength-text-passphrase');
        const passphraseEntropyDisplay = document.getElementById('entropy-passphrase');
        const copyPassphraseButton = document.getElementById('copy-passphrase-btn');
        let isLoadingHistory = false;

        tabElements.forEach(tab => {
            tab.addEventListener('click', () => {
                tabElements.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));

                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        passphraseLengthInput.addEventListener('input', () => {
          passphraseLengthDisplay.textContent = passphraseLengthInput.value;
        });


        lengthSlider.addEventListener('input', function() {
            lengthValue.textContent = this.value;
            updateStrengthBar();
        });

        [lowercaseCheck, uppercaseCheck, digitsCheck, specialCheck, similarCheck, ambiguousCheck].forEach(checkbox => {
            checkbox.addEventListener('change', updateStrengthBar);
        });

        generateBtn.addEventListener('click', generatePasswords);

        copyBtn.addEventListener('click', function() {
            if (outputArea.value) {
                navigator.clipboard.writeText(outputArea.value)
                    .then(() => showTooltip(copyBtn, 'Copied to clipboard!'))
                    .catch(err => alert('Failed to copy: ' + err));
            } else {
                showTooltip(copyBtn, 'Generate passwords first!');
            }
        });

        saveBtn.addEventListener('click', saveToHistory);

        analyzeBtn.addEventListener('click', analyzePassword);

        clearHistoryBtn.addEventListener('click', clearHistory);

        themeSelect.addEventListener('change', changeTheme);

        exportSettingsBtn.addEventListener('click', exportSettings);
        importSettingsBtn.addEventListener('click', importSettings);

        loadSettings();
        loadHistory();
        updateStrengthBar();
        loadWords();

        numPasswordsInput.addEventListener('input', () => {
            let value = parseInt(input.value, 10);
        
            if (isNaN(value)) {
              input.value = 1;
            } else if (value < 1) {
              input.value = 1;
            } else if (value > 10) {
              input.value = 10;
            }
        });


        function generatePassphrase(numWords) {
          if (!wordsList.length) return 'Word list not loaded!';
          let phrase = [];
          const characterInput = document.getElementById('character-between-phrase');
          const separator = characterInput?.value || '-';
        
          for (let i = 0; i < numWords; i++) {
            const randomWord = wordsList[Math.floor(Math.random() * wordsList.length)];
            phrase.push(randomWord);
          }
        
          return phrase.join(separator);
        }
        
        function calculateEntropy_phrases(numWords) {
          return (Math.log2(wordsList.length) * numWords).toFixed(2);
        }

        generatePassphraseButton.addEventListener('click', () => {
          const numWords = parseInt(passphraseLengthInput.value, 10);
          const numPassphrases = parseInt(passphraseCountInput.value, 10);
          const prefix = passphrasePrefixInput.value.trim();
          const postfix = passphrasePostfixInput.value.trim();
        
          if (wordsList.length === 0) {
            showTooltip(generatePassphraseButton, 'Word list not loaded yet!');
            return;
          }
        
          if (numWords < 3 || numWords > 12) {
            showTooltip(passphraseLengthInput, 'Number of words must be between 3 and 12');
            return;
          }
        
          if (numPassphrases < 1 || numPassphrases > 10) {
            showTooltip(passphraseCountInput, 'Number to generate must be between 1 and 10');
            return;
          }
        
          const results = [];
          for (let i = 0; i < numPassphrases; i++) {
            let phrase = generatePassphrase(numWords);
            if (prefix) phrase = prefix + phrase;
            if (postfix) phrase = phrase + postfix;
            results.push(phrase);
          }
        
          passphraseOutputBox.value = results.join('\n');
        
          const entropyVal = calculateEntropy_phrases(numWords);
          const maxEntropy = 12 * Math.log2(wordsList.length);
          const strengthPercent = Math.min(100, (entropyVal / maxEntropy) * 100);
        
          passphraseStrengthBar.style.width = strengthPercent + '%';
        
          let strengthLabel = 'Weak';
          if (strengthPercent > 80) strengthLabel = 'Very Strong';
          else if (strengthPercent > 60) strengthLabel = 'Strong';
          else if (strengthPercent > 40) strengthLabel = 'Moderate';
          else if (strengthPercent > 20) strengthLabel = 'Weak';
        
          passphraseStrengthText.textContent = 'Strength: ' + strengthLabel;
          passphraseEntropyDisplay.textContent = `Entropy: ${entropyVal} bits`;
        
          showTooltip(generatePassphraseButton, 'Passphrases generated!');
        });

        copyPassphraseButton.addEventListener('click', () => {
          if (!passphraseOutputBox.value) {
            showTooltip(copyPassphraseButton, 'Nothing to copy!');
            return;
          }
        
          passphraseOutputBox.select();
          passphraseOutputBox.setSelectionRange(0, 99999);
        
          try {
            document.execCommand('copy');
            showTooltip(copyPassphraseButton, 'Copied!');
          } catch (err) {
            showTooltip(copyPassphraseButton, 'Copy failed!');
          }
        
          window.getSelection().removeAllRanges();
        });

        async function checkPasswordBreach(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest("SHA-1", data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('').toUpperCase();
        
            const prefix = hashHex.slice(0, 5);
            const suffix = hashHex.slice(5);
        
            const response = await fetch(`https://api.pwnedpasswords.com/range/${prefix}`);
            const text = await response.text();
            const lines = text.split("\n");
        
            for (const line of lines) {
                const [lineSuffix, count] = line.split(":");
                if (lineSuffix === suffix) {
                    return parseInt(count);
                }
            }
        
            return 0;
        }

        function estimateCrackTime(entropy) {
            const guesses = 4.4 ** entropy;
            const guessesPerSecond = 1e7;
            const seconds = guesses / guessesPerSecond;
        
            if (seconds < 60) return `${seconds.toFixed(2)} seconds`;
            if (seconds < 3600) return `${(seconds / 60).toFixed(2)} minutes`;
            if (seconds < 86400) return `${(seconds / 3600).toFixed(2)} hours`;
            if (seconds < 31536000) return `${(seconds / 86400).toFixed(2)} days`;
            if (seconds < 3.15e8) return `${(seconds / 2.628e6).toFixed(2)} months`;
            return `${(seconds / 3.154e7).toFixed(2)} years`;
        }

        
        function updateStrengthBar() {
            const length = parseInt(lengthSlider.value);

            let charSet = 0;
            const similarChars = "il1Lo0O";
            const ambiguousChars = "{}[]()/\\'\"`~,;:.<>";

            if (lowercaseCheck.checked) charSet += 26;
            if (uppercaseCheck.checked) charSet += 26;
            if (digitsCheck.checked) charSet += 10;
            if (specialCheck.checked) charSet += 32;

            if (!similarCheck.checked) charSet -= countUnique(similarChars);
            if (!ambiguousCheck.checked) charSet -= countUnique(ambiguousChars);

            charSet = Math.max(1, charSet);

            const entropy = length * Math.log2(charSet);
            entropyText.textContent = `Entropy: ${entropy.toFixed(1)} bits`;

            const strengthPercent = Math.min(100, (entropy / 128) * 100);
            strengthBar.style.width = strengthPercent + '%';

            let strength, color;
            if (entropy < 28) {
                strength = "Very Weak";
                color = "#dc2626"; 
            } else if (entropy < 40) {
                strength = "Weak";
                color = "#f97316"; 
            } else if (entropy < 60) {
                strength = "Fair";
                color = "#eab308"; 
            } else if (entropy < 80) {
                strength = "Good";
                color = "#10b981"; 
            } else if (entropy < 100) {
                strength = "Strong";
                color = "#3b82f6"; 
            } else {
                strength = "Very Strong";
                color = "#8b5cf6"; 
            }

            strengthText.textContent = `Strength: ${strength}`;
            strengthBar.style.backgroundColor = color;
        }

        function countUnique(str) {
            return new Set(str.split('')).size;
        }

        function generatePasswords() {
            const length = parseInt(lengthSlider.value);
            const num = parseInt(numPasswordsInput.value);
            const prefix = prefixInput.value;
            const postfix = postfixInput.value;

            let lowercase = lowercaseCheck.checked ? 'abcdefghijklmnopqrstuvwxyz' : '';
            let uppercase = uppercaseCheck.checked ? 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' : '';
            let digits = digitsCheck.checked ? '0123456789' : '';
            let special = specialCheck.checked ? '!@#$%^&*()_-+=<>?/[]{}|' : '';

            if (!similarCheck.checked) {
                lowercase = lowercase.replace(/[il1]/g, '');
                uppercase = uppercase.replace(/[IL]/g, '');
                digits = digits.replace(/[01]/g, '');
            }

            if (!ambiguousCheck.checked) {
                special = special.replace(/[{}[\]()\/\\'"`~,;:.<>]/g, '');
            }

            const chars = lowercase + uppercase + digits + special;

            if (!chars) {
                showTooltip(generateBtn, 'No character set selected!');
                return;
            }

            const passwords = [];
            for (let i = 0; i < num; i++) {

                const coreLength = Math.max(1, length - prefix.length - postfix.length);

                let passwordParts = [];
                if (lowercase) passwordParts.push(getRandomChar(lowercase));
                if (uppercase) passwordParts.push(getRandomChar(uppercase));
                if (digits) passwordParts.push(getRandomChar(digits));
                if (special) passwordParts.push(getRandomChar(special));

                const remainingLength = coreLength - passwordParts.length;
                if (remainingLength > 0) {
                    for (let j = 0; j < remainingLength; j++) {
                        passwordParts.push(getRandomChar(chars));
                    }
                }

                passwordParts = shuffleArray(passwordParts);

                passwords.push(prefix + passwordParts.join('') + postfix);
            }

            outputArea.value = passwords.join('\n');

            updateStrengthBar();

            if (autoCopyCheck.checked) {
                navigator.clipboard.writeText(outputArea.value)
                    .then(() => showTooltip(copyBtn, 'Auto-copied to clipboard!'))
                    .catch(err => console.error('Failed to auto-copy:', err));
            }

            if (autoSaveCheck.checked) {
                saveToHistory();
            }
        }

        async function analyzePassword() {
            const password = analyzeInput.value.trim();
            if (!password) {
                analysisResults.innerHTML = '<p class="text-warning">Please enter a password to analyze</p>';
                return;
            }
        
            const charSet = getCharacterSetSize(password);
            const entropy = password.length * Math.log2(charSet);
        
            const hasLower = /[a-z]/.test(password);
            const hasUpper = /[A-Z]/.test(password);
            const hasDigit = /\d/.test(password);
            const hasSpecial = /[^a-zA-Z0-9]/.test(password);
            const crackTime = estimateCrackTime(entropy);
            const isCommon = checkCommonPassword(password);
            const breachCount = await checkPasswordBreach(password);
        
            let html = `
                <div class="analysis-item">
                    <span>Length:</span>
                    <span class="badge ${password.length >= 12 ? 'badge-success' : password.length >= 8 ? 'badge-warning' : 'badge-danger'}">
                        ${password.length} characters
                    </span>
                </div>
                <div class="analysis-item">
                    <span>Character variety:</span>
                    <span class="badge ${charSet > 60 ? 'badge-success' : charSet > 30 ? 'badge-warning' : 'badge-danger'}">
                        ${Math.round(charSet)} unique characters
                    </span>
                </div>
                <div class="analysis-item">
                    <span>Estimated entropy:</span>
                    <span class="badge ${entropy > 80 ? 'badge-success' : entropy > 50 ? 'badge-warning' : 'badge-danger'}">
                        ${entropy.toFixed(1)} bits
                    </span>
                </div>
                <div class="analysis-item">
                    <span>Contains lowercase:</span>
                    <span class="badge ${hasLower ? 'badge-success' : 'badge-warning'}">
                        ${hasLower ? 'Yes' : 'No'}
                    </span>
                </div>
                <div class="analysis-item">
                    <span>Contains uppercase:</span>
                    <span class="badge ${hasUpper ? 'badge-success' : 'badge-warning'}">
                        ${hasUpper ? 'Yes' : 'No'}
                    </span>
                </div>
                <div class="analysis-item">
                    <span>Contains digits:</span>
                    <span class="badge ${hasDigit ? 'badge-success' : 'badge-warning'}">
                        ${hasDigit ? 'Yes' : 'No'}
                    </span>
                </div>
                <div class="analysis-item">
                    <span>Contains special chars:</span>
                    <span class="badge ${hasSpecial ? 'badge-success' : 'badge-warning'}">
                        ${hasSpecial ? 'Yes' : 'No'}
                    </span>
                </div>
                <div class="analysis-item">
                    <span>Estimated crack time:</span>
                    <span class="badge ${entropy > 80 ? 'badge-success' : entropy > 50 ? 'badge-warning' : 'badge-danger'}">
                        ${crackTime}
                    </span>
                </div>
                <div class="analysis-item">
                    <span>Common password:</span>
                    <span class="badge ${isCommon ? 'badge-danger' : 'badge-success'}">
                        ${isCommon ? 'Yes (high risk)' : 'No'}
                    </span>
                </div>
                <div class="analysis-item">
                    <span>Known breach count:</span>
                    <span class="badge ${breachCount > 0 ? 'badge-danger' : 'badge-success'}">
                        ${breachCount > 0 ? breachCount + ' times' : 'Not found'}
                    </span>
                </div>
            `;
        
            analysisResults.innerHTML = html;
        }


        function saveToHistory() {
            if (isLoadingHistory) return;
        
            const passwords = outputArea.value.trim();
            if (!passwords) {
                showTooltip(saveBtn, 'Generate passwords first!');
                return;
            }
        
            const history = JSON.parse(localStorage.getItem('passwordHistory') || '[]');
            const newEntries = passwords.split('\n').map(pwd => ({
                password: pwd,
                timestamp: new Date().toISOString(),
                strength: strengthText.textContent.replace('Strength: ', ''),
                entropy: entropyText.textContent.replace('Entropy: ', '')
            }));
        
            const updatedHistory = [...history, ...newEntries].slice(-50);
            localStorage.setItem('passwordHistory', JSON.stringify(updatedHistory));
        
            loadHistory();
            showTooltip(saveBtn, 'Saved to history!');
        }

        
        function loadHistory() {
            if (isLoadingHistory) return;
            isLoadingHistory = true;
        
            requestAnimationFrame(() => {
                const history = JSON.parse(localStorage.getItem('passwordHistory') || '[]');
                const container = document.getElementById('password-history');
        
                if (!container) {
                    console.error('Missing #password-history element.');
                    isLoadingHistory = false;
                    return;
                }
        
                container.innerHTML = '';
        
                if (history.length === 0) {
                    container.innerHTML = '<p>No passwords saved yet. Generate and save passwords to view them here.</p>';
                    isLoadingHistory = false;
                    return;
                }
        
                history.forEach((entry, index) => {
                    const item = document.createElement('div');
                    item.className = 'history-item';
                    item.innerHTML = `
                        <div class="password">${entry.password}</div>
                        <div class="actions">
                            <button class="btn btn-secondary copy-history" data-index="${index}">
                                <i class="far fa-copy"></i>
                            </button>
                            <button class="btn btn-secondary delete-history" data-index="${index}">
                                <i class="far fa-trash-alt"></i>
                            </button>
                        </div>
                    `;
                    container.appendChild(item);
                });
        
                container.querySelectorAll('.copy-history').forEach(btn => {
                    btn.addEventListener('click', function () {
                        const index = this.dataset.index;
                        const history = JSON.parse(localStorage.getItem('passwordHistory'));
                        navigator.clipboard.writeText(history[index].password)
                            .then(() => showTooltip(btn, 'Copied to clipboard!'))
                            .catch(err => console.error('Failed to copy:', err));
                    });
                });
        
                container.querySelectorAll('.delete-history').forEach(btn => {
                    btn.addEventListener('click', function () {
                        const index = this.dataset.index;
                        const history = JSON.parse(localStorage.getItem('passwordHistory'));
                        history.splice(index, 1);
                        localStorage.setItem('passwordHistory', JSON.stringify(history));
                        loadHistory();
                    });
                });
        
                isLoadingHistory = false;
            });
        }


        function clearHistory() {
            localStorage.removeItem('passwordHistory');
            loadHistory();
            showTooltip(clearHistoryBtn, 'History cleared!');
        }

        function changeTheme() {

            showTooltip(themeSelect, 'Theme changed!');
        }

        function exportSettings() {
            const settings = {
                length: lengthSlider.value,
                lowercase: lowercaseCheck.checked,
                uppercase: uppercaseCheck.checked,
                digits: digitsCheck.checked,
                special: specialCheck.checked,
                similar: similarCheck.checked,
                ambiguous: ambiguousCheck.checked,
                prefix: prefixInput.value,
                postfix: postfixInput.value,
                numPasswords: numPasswordsInput.value,
                autoCopy: autoCopyCheck.checked,
                autoSave: autoSaveCheck.checked,
                theme: themeSelect.value
            };

            const data = JSON.stringify(settings, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = 'password-generator-settings.json';
            a.click();

            URL.revokeObjectURL(url);
            showTooltip(exportSettingsBtn, 'Settings exported!');
        }

        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';

            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();

                reader.onload = event => {
                    try {
                        const settings = JSON.parse(event.target.result);

                        lengthSlider.value = settings.length;
                        lengthValue.textContent = settings.length;
                        lowercaseCheck.checked = settings.lowercase;
                        uppercaseCheck.checked = settings.uppercase;
                        digitsCheck.checked = settings.digits;
                        specialCheck.checked = settings.special;
                        similarCheck.checked = settings.similar;
                        ambiguousCheck.checked = settings.ambiguous;
                        prefixInput.value = settings.prefix;
                        postfixInput.value = settings.postfix;
                        numPasswordsInput.value = settings.numPasswords;
                        autoCopyCheck.checked = settings.autoCopy;
                        autoSaveCheck.checked = settings.autoSave;
                        themeSelect.value = settings.theme;

                        updateStrengthBar();
                        showTooltip(importSettingsBtn, 'Settings imported!');
                    } catch (err) {
                        showTooltip(importSettingsBtn, 'Invalid settings file!');
                        console.error('Error importing settings:', err);
                    }
                };

                reader.readAsText(file);
            };

            input.click();
        }

        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('generatorSettings')) || {};

            if (settings.length) lengthSlider.value = settings.length;
            if (settings.lowercase !== undefined) lowercaseCheck.checked = settings.lowercase;
            if (settings.uppercase !== undefined) uppercaseCheck.checked = settings.uppercase;
            if (settings.digits !== undefined) digitsCheck.checked = settings.digits;
            if (settings.special !== undefined) specialCheck.checked = settings.special;
            if (settings.similar !== undefined) similarCheck.checked = settings.similar;
            if (settings.ambiguous !== undefined) ambiguousCheck.checked = settings.ambiguous;
            if (settings.prefix !== undefined) prefixInput.value = settings.prefix;
            if (settings.postfix !== undefined) postfixInput.value = settings.postfix;
            if (settings.numPasswords !== undefined) numPasswordsInput.value = settings.numPasswords;
            if (settings.autoCopy !== undefined) autoCopyCheck.checked = settings.autoCopy;
            if (settings.autoSave !== undefined) autoSaveCheck.checked = settings.autoSave;
            if (settings.theme) themeSelect.value = settings.theme;

            lengthValue.textContent = lengthSlider.value;
            updateStrengthBar();
        }

        function saveSettings() {
            const settings = {
                length: lengthSlider.value,
                lowercase: lowercaseCheck.checked,
                uppercase: uppercaseCheck.checked,
                digits: digitsCheck.checked,
                special: specialCheck.checked,
                similar: similarCheck.checked,
                ambiguous: ambiguousCheck.checked,
                prefix: prefixInput.value,
                postfix: postfixInput.value,
                numPasswords: numPasswordsInput.value,
                autoCopy: autoCopyCheck.checked,
                autoSave: autoSaveCheck.checked,
                theme: themeSelect.value
            };

            localStorage.setItem('generatorSettings', JSON.stringify(settings));
        }

        function getRandomChar(str) {
            return str[Math.floor(Math.random() * str.length)];
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function getCharacterSetSize(password) {
            const uniqueChars = new Set(password.split(''));
            return uniqueChars.size;
        }

        function checkCommonPassword(password) {
            const common = [
                '123456', 'password', '123456789', '12345678', '12345', '111111', '1234567', 'sunshine', 'qwerty', 'iloveyou',
                'princess', 'admin', 'welcome', '666666', 'abc123', 'football', '123123', 'monkey', '654321', '!@#$%^&*',
                'charlie', 'aa123456', 'donald', 'password1', 'qwerty123', 'zxcvbnm', '1q2w3e4r', 'dragon', 'master', 'hello',
                'freedom', 'whatever', 'qazwsx', 'trustno1', 'letmein', '123qwe', 'baseball', 'superman', 'michael', '696969',
                'batman', 'jordan', 'harley', 'buster', 'thomas', 'tigger', 'robert', 'soccer', 'killer', 'hockey', 'george',
                'andrew', 'joshua', 'cheese', 'pepper', 'internet', 'summer', 'ginger', 'cookie', 'shadow', 'pepper', 'silver',
                'merlin', 'michelle', 'corvette', 'bigdog', 'gandalf', 'asdfgh', 'starwars', 'matrix', 'computer', 'blahblah',
                'pokemon', 'naruto', 'spiderman', 'batman123', 'passw0rd', 'hello123', 'monkey123', 'mustang', 'lovely',
                'secret', 'flower', 'ashley', 'bailey', 'qwertyuiop', 'daniel', 'maggie', 'buster', 'william', 'snoopy',
                'carlos', 'gabriel', 'madison', 'nicole', 'jesus', 'hannah', 'samantha', 'andrea', 'london', 'paris', '777777',
                'welcome1', 'password123', 'abc123456', 'monkey1', '1qaz2wsx', '123abc', '987654321', 'qwe123', 'qweasd',
                'qweqwe', '11111111', '121212', '000000', '1234567890', 'asdf1234', 'pass1234', 'root', 'admin123', '123321',
                '112233', '102030', '232323', '445566', 'password!', 'qwerty1', '1q2w3e', 'zaq1zaq1', '1g2w3e4r', '321321',
                '456789', 'password2', 'asdfasdf', 'a1b2c3', 'pass123', 'loveme', '123', '6969', 'q1w2e3r4', '1a2b3c',
                'asdf', 'super', '1password', 'samsung', 'playboy', 'ninja', 'trustme', 'killer123', 'batman1', 'pokemon123',
                '123456a', 'abc12345', 'myspace1', 'firebird', 'password4', 'test123', 'asdfg', 'aaaaaa', 'zxcvbn', 'qwe',
                'asdfghjkl', 'football1', 'hottie', 'jennifer', 'asdf123', 'internet1', 'lol123', 'google', 'michelle1',
                'happy', 'lucky', '7777777', 'ginger1', 'love123', 'jordan23', 'nintendo', 'facebook', 'asdfg123', 'hunter',
                'boomer', 'cameron', 'secret1', 'newyork', 'mypass', 'mypass123', 'mysecret', 'mypassword', 'mylife', 'apple',
                'windows', 'ubuntu', 'linux', 'iloveyou1', 'sexy', 'trust', 'bank', 'money', 'rich', 'poor', 'jobless',
                'working', 'default', 'changeme', 'qweqwe123', 'test', 'test1234', 'root123', 'admin1', '123admin', 'admin1234',
                'iloveme', 'adminadmin', '1admin', '1admin1', 'me123', 'me12345', '1111', '2222', '3333', '4444', '5555',
                '6666', '7777', '8888', '9999', '0000', '131313', '121314', '789456', '159753', '852456', '456123', '741852',
                '147258', '369258', '258369', '963852', 'adminadmin123', 'administrator', 'system', 'guest', 'superuser',
                'superadmin', 'q1w2e3', 'q1w2e3r4t5', '123qweasd', 'asdfqwer', 'passw0rd1', 'passw0rd!', 'pass123!', 'myspace',
                'ilovepasswords', 'passion', 'football123', 'letmein123', '123456789a', 'access', 'access123', 'qazwsxedc',
                'zaq12wsx', 'zxcvbn123', '1a2b3c4d', 'abcd1234', 'abcde12345', 'abcdefg', 'securepassword', 'secur3', 'strongpass',
                'strongpassword', 'qwertyui', 'qwerty12', 'passcode', 'passphrase', 'mypassw0rd', 'supersecret', 'ultrasecret',
                'topsecret', 'notsecure', 'reallysecure', 'supersecure', 'adminadmin1', 'letmeinplease', 'qwerty123456', '00000000'
            ];
            return common.includes(password.toLowerCase());
        }

        function showTooltip(element, message) {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip-message';
            tooltip.textContent = message;
            tooltip.style.position = 'absolute';
            tooltip.style.background = 'var(--card-bg)';
            tooltip.style.color = 'var(--text-primary)';
            tooltip.style.padding = '0.5rem 1rem';
            tooltip.style.borderRadius = '4px';
            tooltip.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
            tooltip.style.zIndex = '1000';
            tooltip.style.whiteSpace = 'nowrap';

            const rect = element.getBoundingClientRect();
            tooltip.style.top = `${rect.top - 40}px`;
            tooltip.style.left = `${rect.left + rect.width/2}px`;
            tooltip.style.transform = 'translateX(-50%)';

            document.body.appendChild(tooltip);

            setTimeout(() => {
                tooltip.style.opacity = '0';
                tooltip.style.transition = 'opacity 0.3s';
                setTimeout(() => tooltip.remove(), 300);
            }, 2000);
        }

       document.getElementById('export-history').addEventListener('click', function () {
            const history = JSON.parse(localStorage.getItem('passwordHistory') || '[]');
           
            if (!history.length) {
                alert('No passwords to export!');
                return;
            }
        
            const exportText = history.map(entry => entry.password).join('\n');
        
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
        
            const link = document.createElement('a');
            link.href = url;
            link.download = 'password_history.txt';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        });



        window.addEventListener('beforeunload', saveSettings);
    </script>
</body>
</html>
