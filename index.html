<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Password Generator</title>
    <link rel="stylesheet" href="./style.css">
    <!-- Debugging script -->
    <script>
        console.log("HTML loaded successfully");
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM fully loaded");
            // Temporary debug background
            document.body.style.backgroundColor = '#121212';
            console.log("Default background color set");
        });
    </script>
</head>
<body>
    <h1>Advanced Password Generator</h1>
    
    <div class="control-group">
        <label for="length">Length:</label>
        <input type="range" id="length" min="8" max="64" value="16">
        <span id="length-value">16</span>
    </div>
    
    <div class="security-info">
        <div class="strength-meter">
            <div class="strength-bar" id="strength-bar"></div>
        </div>
        <div id="entropy">Entropy: 0 bits</div>
    </div>
    
    <div id="strength-text">Strength: Unknown</div>
    
    <div class="control-group">
        <label for="prefix">Prefix:</label>
        <input type="text" id="prefix">
        <label for="postfix">Postfix:</label>
        <input type="text" id="postfix">
    </div>
    
    <div class="control-group">
        <label for="num-passwords">Number:</label>
        <input type="number" id="num-passwords" min="1" max="50" value="5">
    </div>
    
    <div class="checkbox-group">
        <div class="checkbox-item">
            <input type="checkbox" id="lowercase" checked>
            <label for="lowercase">a-z Lowercase</label>
        </div>
        <div class="checkbox-item">
            <input type="checkbox" id="uppercase" checked>
            <label for="uppercase">A-Z Uppercase</label>
        </div>
        <div class="checkbox-item">
            <input type="checkbox" id="digits" checked>
            <label for="digits">0-9 Digits</label>
        </div>
        <div class="checkbox-item">
            <input type="checkbox" id="special" checked>
            <label for="special">!@# Special Chars</label>
        </div>
    </div>
    
    <button id="generate-btn">ðŸš€ GENERATE PASSWORDS</button>
    
    <textarea id="output" readonly></textarea>
    
    <button id="copy-btn">ðŸ“‹ COPY ALL PASSWORDS</button>

    <!-- Debug element (visible only if CSS fails to load) -->
    <div id="debug-message" style="color: red; display: none;">
        CSS failed to load! Check console for errors.
    </div>
    
    <script>
        // Debug: Check if CSS loaded
        setTimeout(() => {
            const bodyColor = window.getComputedStyle(document.body).backgroundColor;
            if (bodyColor === 'rgba(0, 0, 0, 0)' || bodyColor === 'white') {
                document.getElementById('debug-message').style.display = 'block';
                console.error("CSS not detected!");
            }
        }, 100);

        // DOM Elements
        const lengthSlider = document.getElementById('length');
        const lengthValue = document.getElementById('length-value');
        const lowercaseCheck = document.getElementById('lowercase');
        const uppercaseCheck = document.getElementById('uppercase');
        const digitsCheck = document.getElementById('digits');
        const specialCheck = document.getElementById('special');
        const prefixInput = document.getElementById('prefix');
        const postfixInput = document.getElementById('postfix');
        const numPasswordsInput = document.getElementById('num-passwords');
        const generateBtn = document.getElementById('generate-btn');
        const copyBtn = document.getElementById('copy-btn');
        const outputArea = document.getElementById('output');
        const strengthBar = document.getElementById('strength-bar');
        const strengthText = document.getElementById('strength-text');
        const entropyText = document.getElementById('entropy');
        
        // Update length value display
        lengthSlider.addEventListener('input', function() {
            lengthValue.textContent = this.value;
            updateStrengthBar();
        });
        
        // Update strength when options change
        [lowercaseCheck, uppercaseCheck, digitsCheck, specialCheck].forEach(checkbox => {
            checkbox.addEventListener('change', updateStrengthBar);
        });
        
        // Generate passwords
        generateBtn.addEventListener('click', generatePasswords);
        
        // Copy passwords
        copyBtn.addEventListener('click', function() {
            if (outputArea.value) {
                navigator.clipboard.writeText(outputArea.value)
                    .then(() => alert('All passwords copied to clipboard! ðŸ“‹'))
                    .catch(err => alert('Failed to copy: ' + err));
            } else {
                alert('Generate passwords first!');
            }
        });
        
        // Calculate entropy
        function calculateEntropy(length, charSetSize) {
            if (charSetSize <= 0 || length <= 0) return 0;
            return length * Math.log2(charSetSize);
        }
        
        // Update strength bar
        function updateStrengthBar() {
            const length = parseInt(lengthSlider.value);
            let charSet = 0;
            
            // Character sets
            if (lowercaseCheck.checked) charSet += 26;
            if (uppercaseCheck.checked) charSet += 26;
            if (digitsCheck.checked) charSet += 10;
            if (specialCheck.checked) charSet += 20;
            
            // Calculate entropy
            const entropy = calculateEntropy(length, charSet);
            entropyText.textContent = `Entropy: ${entropy.toFixed(1)} bits`;
            
            // Calculate strength percentage (0-100)
            const strengthPercent = Math.min(100, (entropy / 128) * 100);
            strengthBar.style.width = strengthPercent + '%';
            
            // Set strength text and color
            let strength, color;
            if (entropy < 40) {
                strength = "Weak";
                color = "var(--warning-color)";
            } else if (entropy < 70) {
                strength = "Good";
                color = "#ffeb3b";
            } else if (entropy < 100) {
                strength = "Strong";
                color = "var(--success-color)";
            } else {
                strength = "Very Strong";
                color = "var(--accent-color)";
            }
            
            strengthText.textContent = `Strength: ${strength}`;
            strengthBar.style.backgroundColor = color;
        }
        
        // Generate passwords
        function generatePasswords() {
            const length = parseInt(lengthSlider.value);
            const num = parseInt(numPasswordsInput.value);
            const prefix = prefixInput.value;
            const postfix = postfixInput.value;
            
            // Define character sets
            const lowercase = lowercaseCheck.checked ? 'abcdefghijklmnopqrstuvwxyz' : '';
            const uppercase = uppercaseCheck.checked ? 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' : '';
            const digits = digitsCheck.checked ? '0123456789' : '';
            const special = specialCheck.checked ? '!@#$%^&*()_-+=<>?/[]{}|' : '';
            
            // Combine character sets
            const chars = lowercase + uppercase + digits + special;
            
            // Validate character set
            if (!chars) {
                alert('No character set selected!');
                return;
            }
            
            const passwords = [];
            for (let i = 0; i < num; i++) {
                // Calculate core length (without prefix/postfix)
                const coreLength = Math.max(1, length - prefix.length - postfix.length);
                
                // Ensure at least one character from each selected set
                let passwordParts = [];
                if (lowercase) passwordParts.push(getRandomChar(lowercase));
                if (uppercase) passwordParts.push(getRandomChar(uppercase));
                if (digits) passwordParts.push(getRandomChar(digits));
                if (special) passwordParts.push(getRandomChar(special));
                
                // Fill remaining length with random characters
                const remainingLength = coreLength - passwordParts.length;
                if (remainingLength > 0) {
                    for (let j = 0; j < remainingLength; j++) {
                        passwordParts.push(getRandomChar(chars));
                    }
                }
                
                // Shuffle to mix the characters
                passwordParts = shuffleArray(passwordParts);
                
                // Combine with prefix and postfix
                passwords.push(prefix + passwordParts.join('') + postfix);
            }
            
            // Display passwords
            outputArea.value = passwords.join('\n');
            
            // Update strength bar with final calculation
            updateStrengthBar();
        }
        
        // Helper functions
        function getRandomChar(str) {
            return str[Math.floor(Math.random() * str.length)];
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // Initialize strength bar
        updateStrengthBar();
    </script>
</body>
</html>
